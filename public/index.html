<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velo-Altitude - Explorez les plus beaux cols de montagne</title>
    <meta name="description" content="Découvrez les plus beaux cols cyclistes avec Velo-Altitude, consultez la météo en temps réel, suivez vos entraînements et rejoignez notre communauté passionnée de cyclisme.">
    
    <!-- Favicon -->
    <link rel="icon" href="images/favicon.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- D3.js pour les graphiques -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="modern-styles.css">
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="responsive-fixes.css">
    <link rel="stylesheet" href="technical-debt-fixes.css">
    <link rel="stylesheet" href="visual-elements.css">
    <link rel="stylesheet" href="css/map-components.css">
</head>
<body class="standard">
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <div class="logo-container">
                    <!-- Logo will be injected by JS -->
                </div>
                
                <button class="navbar-toggler" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="navbar-collapse">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a href="#" class="nav-link active">Accueil</a></li>
                        <li class="nav-item"><a href="#cols-explorer" class="nav-link">Cols</a></li>
                        <li class="nav-item"><a href="#weather" class="nav-link">Météo</a></li>
                        <li class="nav-item"><a href="#training" class="nav-link">Entraînement</a></li>
                        <li class="nav-item"><a href="#community" class="nav-link">Communauté</a></li>
                        <li class="nav-item"><a href="#assistant" class="nav-link">Assistant</a></li>
                    </ul>
                    
                    <div class="navbar-actions">
                        <button class="btn btn-sm btn-outline-primary theme-toggle" aria-label="Changer de thème">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button class="btn btn-sm btn-primary login-btn">Connexion</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <div class="hero-content animate-fade-in">
                            <h1 class="hero-title">Découvrez les plus beaux cols de montagne</h1>
                            <p class="hero-subtitle">Planifiez vos sorties, suivez vos performances et rejoignez la communauté des cyclistes de Velo-Altitude.</p>
                            <div class="hero-buttons">
                                <a href="#cols-explorer" class="btn btn-lg btn-primary animate-bounce">Explorer les cols</a>
                                <a href="#" class="btn btn-lg btn-secondary">En savoir plus</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="hero-image animate-fade-in-right">
                            <!-- Hero image will be set as background by CSS -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="dashboard-section section-padding">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Tableau de bord cycliste</h2>
                    <p class="section-subtitle">Suivez toutes vos données en un coup d'œil</p>
                </div>
                
                <div class="dashboard-menu">
                    <button class="btn btn-sm btn-primary dashboard-customize-btn">
                        <i class="fas fa-cog"></i> Personnaliser
                    </button>
                    <div class="dashboard-view-options">
                        <button class="btn btn-sm btn-outline-primary active" data-view="grid">
                            <i class="fas fa-th"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-primary" data-view="list">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-grid" id="dashboard-container">
                    <!-- Carte Mapbox -->
                    <div class="dashboard-widget" data-widget="map">
                        <div class="widget-header">
                            <h3><i class="fas fa-map-marked-alt"></i> Carte & Itinéraires</h3>
                            <div class="widget-actions">
                                <button class="btn btn-sm btn-icon widget-refresh" title="Rafraîchir">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn btn-sm btn-icon widget-expand" title="Agrandir">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div id="map-container" class="map-widget" style="height: 350px;"></div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div id="route-controls">
                                        <button class="btn btn-sm btn-primary calculate-route-btn">
                                            <i class="fas fa-route"></i> Calculer un itinéraire
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary calculate-isochrone-btn">
                                            <i class="fas fa-circle"></i> Zone cyclable
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div id="route-info" class="small"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Météo -->
                    <div class="dashboard-widget" data-widget="weather">
                        <div class="widget-header">
                            <h3><i class="fas fa-cloud-sun"></i> Météo Cycliste</h3>
                            <div class="widget-actions">
                                <button class="btn btn-sm btn-icon widget-refresh" title="Rafraîchir">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn btn-sm btn-icon widget-expand" title="Agrandir">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div id="weather-widget-container"></div>
                            <div id="weather-forecast-container" class="mt-3"></div>
                        </div>
                    </div>
                    
                    <!-- Strava -->
                    <div class="dashboard-widget" data-widget="strava">
                        <div class="widget-header">
                            <h3><i class="fab fa-strava"></i> Activités Strava</h3>
                            <div class="widget-actions">
                                <button class="btn btn-sm btn-icon widget-refresh" title="Rafraîchir">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn btn-sm btn-icon widget-expand" title="Agrandir">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div id="strava-auth-container">
                                <button id="strava-auth-btn" class="btn btn-strava">
                                    <i class="fab fa-strava"></i> Se connecter avec Strava
                                </button>
                            </div>
                            <div id="athlete-info" class="mt-3"></div>
                            <div id="strava-activities-container" class="mt-3"></div>
                            <div id="strava-stats-container" class="mt-3"></div>
                        </div>
                    </div>
                    
                    <!-- Assistant IA -->
                    <div class="dashboard-widget" data-widget="ai-assistant">
                        <div class="widget-header">
                            <h3><i class="fas fa-robot"></i> Assistant Cyclisme</h3>
                            <div class="widget-actions">
                                <button class="btn btn-sm btn-icon widget-refresh" title="Rafraîchir">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn btn-sm btn-icon widget-expand" title="Agrandir">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div id="ai-chat-container" class="ai-chat-widget" style="height: 300px;"></div>
                            <div class="chat-input-container d-flex mt-2">
                                <input type="text" id="ai-chat-input" class="form-control" placeholder="Posez votre question...">
                                <button id="ai-chat-send" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div id="ai-suggestions-container" class="mt-2"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal de personnalisation -->
                <div class="dashboard-customize-modal" id="customize-modal">
                    <div class="customize-modal-content">
                        <div class="customize-modal-header">
                            <h3>Personnaliser le tableau de bord</h3>
                            <button class="close-modal" id="close-customize">&times;</button>
                        </div>
                        <div class="customize-modal-body">
                            <div class="available-widgets">
                                <h4>Widgets disponibles</h4>
                                <div class="widget-options">
                                    <div class="widget-option" data-widget="map">
                                        <input type="checkbox" id="widget-map" checked>
                                        <label for="widget-map">Carte & Itinéraires</label>
                                    </div>
                                    <div class="widget-option" data-widget="weather">
                                        <input type="checkbox" id="widget-weather" checked>
                                        <label for="widget-weather">Météo Cycliste</label>
                                    </div>
                                    <div class="widget-option" data-widget="strava">
                                        <input type="checkbox" id="widget-strava" checked>
                                        <label for="widget-strava">Activités Strava</label>
                                    </div>
                                    <div class="widget-option" data-widget="ai-assistant">
                                        <input type="checkbox" id="widget-ai" checked>
                                        <label for="widget-ai">Assistant Cyclisme</label>
                                    </div>
                                </div>
                            </div>
                            <div class="widget-layout">
                                <h4>Mise en page</h4>
                                <div class="layout-options">
                                    <div class="layout-option" data-layout="2x2">
                                        <input type="radio" name="layout" id="layout-2x2" checked>
                                        <label for="layout-2x2">Grille 2x2</label>
                                    </div>
                                    <div class="layout-option" data-layout="column">
                                        <input type="radio" name="layout" id="layout-column">
                                        <label for="layout-column">Colonne</label>
                                    </div>
                                    <div class="layout-option" data-layout="mixed">
                                        <input type="radio" name="layout" id="layout-mixed">
                                        <label for="layout-mixed">Mixte</label>
                                    </div>
                                </div>
                            </div>
                            <div class="widget-order">
                                <h4>Ordre d'affichage</h4>
                                <ul id="widget-order-list" class="widget-order-list">
                                    <li data-widget="map">1. Carte & Itinéraires</li>
                                    <li data-widget="weather">2. Météo Cycliste</li>
                                    <li data-widget="strava">3. Activités Strava</li>
                                    <li data-widget="ai-assistant">4. Assistant Cyclisme</li>
                                </ul>
                            </div>
                        </div>
                        <div class="customize-modal-footer">
                            <button class="btn btn-primary" id="save-customize">Enregistrer</button>
                            <button class="btn btn-secondary" id="reset-customize">Réinitialiser</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features-section section-padding">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Fonctionnalités principales</h2>
                    <p class="section-subtitle">Tout ce dont vous avez besoin pour vos aventures cyclistes</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card animate-fade-in" data-delay="0.1s">
                            <div class="feature-icon mountain">
                                <!-- Mountain icon will be injected by JS -->
                            </div>
                            <h3 class="feature-title">Explorateur de cols</h3>
                            <p class="feature-description">Découvrez les plus beaux cols de la région avec des informations détaillées sur chaque ascension.</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card animate-fade-in" data-delay="0.2s">
                            <div class="feature-icon weather">
                                <!-- Weather icon will be injected by JS -->
                            </div>
                            <h3 class="feature-title">Météo cycliste</h3>
                            <p class="feature-description">Consultez les prévisions météo spécifiques pour les cyclistes avant de planifier vos sorties.</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card animate-fade-in" data-delay="0.3s">
                            <div class="feature-icon training">
                                <!-- Training icon will be injected by JS -->
                            </div>
                            <h3 class="feature-title">Entraînement</h3>
                            <p class="feature-description">Suivez vos performances, créez des plans d'entraînement personnalisés et atteignez vos objectifs.</p>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card animate-fade-in" data-delay="0.4s">
                            <div class="feature-icon community">
                                <!-- Community icon will be injected by JS -->
                            </div>
                            <h3 class="feature-title">Communauté</h3>
                            <p class="feature-description">Rejoignez la communauté des cyclistes de Velo-Altitude, partagez vos expériences et participez à des événements.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cols Explorer Section -->
        <section id="cols-explorer" class="cols-explorer-section section-padding bg-light">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Explorateur de cols</h2>
                    <p class="section-subtitle">Découvrez les plus beaux cols de la région</p>
                </div>
                
                <div class="cols-explorer-header">
                    <div class="cols-filter">
                        <div class="form-group">
                            <label for="difficulty" class="form-label">Difficulté</label>
                            <select id="difficulty" class="form-control">
                                <option value="all">Toutes</option>
                                <option value="easy">Facile</option>
                                <option value="medium">Moyen</option>
                                <option value="hard">Difficile</option>
                                <option value="expert">Expert</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="region" class="form-label">Région</label>
                            <select id="region" class="form-control">
                                <option value="all">Toutes</option>
                                <option value="vosges">Vosges</option>
                                <option value="ardennes">Ardennes</option>
                                <option value="moselle">Moselle</option>
                                <option value="alsace">Alsace</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="cols-search">
                        <div class="form-group">
                            <label for="search" class="form-label">Recherche</label>
                            <input type="text" id="search" class="form-control" placeholder="Rechercher un col...">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 col-lg-3">
                        <div class="col-card animate-fade-in" data-delay="0.1s">
                            <div class="col-image">
                                <!-- Col image will be set by JS -->
                                <div class="col-image-caption">Col de la Schlucht</div>
                                <span class="difficulty-badge bg-success">Facile</span>
                            </div>
                            <div class="card-body">
                                <div class="col-stats">
                                    <div class="row">
                                        <div class="col-4 text-center">
                                            <p class="stat-value">1135m</p>
                                            <p class="stat-label">Altitude</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">8.7km</p>
                                            <p class="stat-label">Distance</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">6.5%</p>
                                            <p class="stat-label">Pente</p>
                                        </div>
                                    </div>
                                </div>
                                <p class="col-description">Le Col de la Schlucht est l'un des cols les plus connus des Vosges, offrant une montée régulière et des paysages magnifiques.</p>
                                <a href="#" class="btn btn-primary btn-sm">Voir détails</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="col-card animate-fade-in" data-delay="0.2s">
                            <div class="col-image">
                                <!-- Col image will be set by JS -->
                                <div class="col-image-caption">Grand Ballon</div>
                                <span class="difficulty-badge bg-danger">Difficile</span>
                            </div>
                            <div class="card-body">
                                <div class="col-stats">
                                    <div class="row">
                                        <div class="col-4 text-center">
                                            <p class="stat-value">1424m</p>
                                            <p class="stat-label">Altitude</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">13.2km</p>
                                            <p class="stat-label">Distance</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">8.2%</p>
                                            <p class="stat-label">Pente</p>
                                        </div>
                                    </div>
                                </div>
                                <p class="col-description">Le Grand Ballon est le point culminant des Vosges, avec une ascension exigeante et des vues panoramiques exceptionnelles.</p>
                                <a href="#" class="btn btn-primary btn-sm">Voir détails</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="col-card animate-fade-in" data-delay="0.3s">
                            <div class="col-image">
                                <!-- Col image will be set by JS -->
                                <div class="col-image-caption">Col du Donon</div>
                                <span class="difficulty-badge bg-primary">Moyen</span>
                            </div>
                            <div class="card-body">
                                <div class="col-stats">
                                    <div class="row">
                                        <div class="col-4 text-center">
                                            <p class="stat-value">1009m</p>
                                            <p class="stat-label">Altitude</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">10.5km</p>
                                            <p class="stat-label">Distance</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">5.8%</p>
                                            <p class="stat-label">Pente</p>
                                        </div>
                                    </div>
                                </div>
                                <p class="col-description">Le Col du Donon offre une montée régulière à travers la forêt vosgienne, avec un temple gallo-romain au sommet.</p>
                                <a href="#" class="btn btn-primary btn-sm">Voir détails</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="col-card animate-fade-in" data-delay="0.4s">
                            <div class="col-image">
                                <!-- Col image will be set by JS -->
                                <div class="col-image-caption">Col de Grosse Pierre</div>
                                <span class="difficulty-badge bg-warning">Expert</span>
                            </div>
                            <div class="card-body">
                                <div class="col-stats">
                                    <div class="row">
                                        <div class="col-4 text-center">
                                            <p class="stat-value">965m</p>
                                            <p class="stat-label">Altitude</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">4.3km</p>
                                            <p class="stat-label">Distance</p>
                                        </div>
                                        <div class="col-4 text-center">
                                            <p class="stat-value">12.1%</p>
                                            <p class="stat-label">Pente</p>
                                        </div>
                                    </div>
                                </div>
                                <p class="col-description">Le Col de Grosse Pierre est l'un des plus raides du massif vosgien, avec des passages à plus de 15% de pente.</p>
                                <a href="#" class="btn btn-primary btn-sm">Voir détails</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <a href="#" class="btn btn-lg btn-primary">Voir tous les cols</a>
                </div>
            </div>
        </section>

        <!-- Weather Section -->
        <section id="weather" class="weather-section section-padding">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Météo cycliste</h2>
                    <p class="section-subtitle">Consultez les conditions météo avant vos sorties</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="weather-location-selector animate-fade-in">
                            <div class="form-group">
                                <label for="weather-location" class="form-label">Sélectionnez un lieu</label>
                                <select id="weather-location" class="form-control">
                                    <option value="strasbourg">Strasbourg</option>
                                    <option value="colmar">Colmar</option>
                                    <option value="mulhouse">Mulhouse</option>
                                    <option value="metz">Metz</option>
                                    <option value="nancy">Nancy</option>
                                    <option value="reims">Reims</option>
                                    <option value="schlucht">Col de la Schlucht</option>
                                    <option value="grand-ballon">Grand Ballon</option>
                                </select>
                            </div>
                            
                            <div class="weather-forecast-days">
                                <button class="btn btn-primary active">Aujourd'hui</button>
                                <button class="btn btn-outline-primary">Demain</button>
                                <button class="btn btn-outline-primary">J+2</button>
                                <button class="btn btn-outline-primary">J+3</button>
                                <button class="btn btn-outline-primary">J+4</button>
                            </div>
                            
                            <div class="weather-cycling-conditions mt-4">
                                <h3>Conditions cyclistes</h3>
                                <div class="cycling-condition-item">
                                    <div class="condition-icon">
                                        <i class="fas fa-wind"></i>
                                    </div>
                                    <div class="condition-info">
                                        <h4>Vent</h4>
                                        <p>15 km/h - Nord-Est</p>
                                        <div class="condition-rating good">
                                            <i class="fas fa-thumbs-up"></i> Favorable
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="cycling-condition-item">
                                    <div class="condition-icon">
                                        <i class="fas fa-road"></i>
                                    </div>
                                    <div class="condition-info">
                                        <h4>État des routes</h4>
                                        <p>Routes sèches</p>
                                        <div class="condition-rating excellent">
                                            <i class="fas fa-thumbs-up"></i> Excellent
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="cycling-condition-item">
                                    <div class="condition-icon">
                                        <i class="fas fa-temperature-high"></i>
                                    </div>
                                    <div class="condition-info">
                                        <h4>Confort thermique</h4>
                                        <p>18-22°C</p>
                                        <div class="condition-rating excellent">
                                            <i class="fas fa-thumbs-up"></i> Idéal
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="weather-widget animate-fade-in-right">
                            <div class="weather-header">
                                <div class="d-flex align-items-center">
                                    <div class="weather-icon">
                                        <!-- Weather icon will be injected by JS -->
                                    </div>
                                    <div>
                                        <h3 class="weather-location">Strasbourg</h3>
                                        <p class="weather-date">Jeudi 3 Avril</p>
                                    </div>
                                </div>
                                <div class="weather-temp">22°C</div>
                                <p class="weather-condition">Ensoleillé</p>
                            </div>
                            
                            <div class="weather-details">
                                <div class="weather-detail">
                                    <div class="weather-detail-icon">
                                        <i class="fas fa-wind"></i>
                                    </div>
                                    <p class="weather-detail-value">15 km/h</p>
                                    <p class="weather-detail-label">Vent</p>
                                </div>
                                
                                <div class="weather-detail">
                                    <div class="weather-detail-icon">
                                        <i class="fas fa-tint"></i>
                                    </div>
                                    <p class="weather-detail-value">30%</p>
                                    <p class="weather-detail-label">Humidité</p>
                                </div>
                                
                                <div class="weather-detail">
                                    <div class="weather-detail-icon">
                                        <i class="fas fa-cloud-rain"></i>
                                    </div>
                                    <p class="weather-detail-value">0%</p>
                                    <p class="weather-detail-label">Précipitations</p>
                                </div>
                                
                                <div class="weather-detail">
                                    <div class="weather-detail-icon">
                                        <i class="fas fa-sun"></i>
                                    </div>
                                    <p class="weather-detail-value">UV 5</p>
                                    <p class="weather-detail-label">Indice UV</p>
                                </div>
                            </div>
                            
                            <div class="weather-hourly mt-4">
                                <h4>Prévisions horaires</h4>
                                <div class="hourly-forecast">
                                    <div class="hourly-item">
                                        <p class="hourly-time">8h</p>
                                        <i class="fas fa-cloud-sun"></i>
                                        <p class="hourly-temp">16°C</p>
                                    </div>
                                    
                                    <div class="hourly-item">
                                        <p class="hourly-time">10h</p>
                                        <i class="fas fa-sun"></i>
                                        <p class="hourly-temp">19°C</p>
                                    </div>
                                    
                                    <div class="hourly-item">
                                        <p class="hourly-time">12h</p>
                                        <i class="fas fa-sun"></i>
                                        <p class="hourly-temp">22°C</p>
                                    </div>
                                    
                                    <div class="hourly-item">
                                        <p class="hourly-time">14h</p>
                                        <i class="fas fa-sun"></i>
                                        <p class="hourly-temp">23°C</p>
                                    </div>
                                    
                                    <div class="hourly-item">
                                        <p class="hourly-time">16h</p>
                                        <i class="fas fa-sun"></i>
                                        <p class="hourly-temp">22°C</p>
                                    </div>
                                    
                                    <div class="hourly-item">
                                        <p class="hourly-time">18h</p>
                                        <i class="fas fa-cloud-sun"></i>
                                        <p class="hourly-temp">20°C</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Training Section -->
        <section id="training" class="training-section section-padding bg-light">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Entraînement</h2>
                    <p class="section-subtitle">Suivez vos performances et atteignez vos objectifs</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <div class="training-plans animate-fade-in">
                            <h3>Plans d'entraînement</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="training-plan-card">
                                        <div class="training-plan-header">
                                            <h4>Débutant</h4>
                                            <p>8 semaines</p>
                                        </div>
                                        <div class="training-plan-body">
                                            <div class="training-plan-stats">
                                                <div class="training-plan-stat">
                                                    <p class="training-plan-stat-value">3-4</p>
                                                    <p class="training-plan-stat-label">Sorties/semaine</p>
                                                </div>
                                                <div class="training-plan-stat">
                                                    <p class="training-plan-stat-value">100-150</p>
                                                    <p class="training-plan-stat-label">km/semaine</p>
                                                </div>
                                                <div class="training-plan-stat">
                                                    <p class="training-plan-stat-value">500-800</p>
                                                    <p class="training-plan-stat-label">D+/semaine</p>
                                                </div>
                                            </div>
                                            
                                            <p>Plan idéal pour les débutants souhaitant développer leur endurance et leur technique.</p>
                                            
                                            <div class="training-plan-progress">
                                                <div class="training-plan-progress-bar" style="width: 25%"></div>
                                            </div>
                                            <p class="text-center">Progression: 25%</p>
                                            
                                            <a href="#" class="btn btn-primary btn-block">Voir le plan</a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="training-plan-card">
                                        <div class="training-plan-header">
                                            <h4>Intermédiaire</h4>
                                            <p>12 semaines</p>
                                        </div>
                                        <div class="training-plan-body">
                                            <div class="training-plan-stats">
                                                <div class="training-plan-stat">
                                                    <p class="training-plan-stat-value">4-5</p>
                                                    <p class="training-plan-stat-label">Sorties/semaine</p>
                                                </div>
                                                <div class="training-plan-stat">
                                                    <p class="training-plan-stat-value">200-250</p>
                                                    <p class="training-plan-stat-label">km/semaine</p>
                                                </div>
                                                <div class="training-plan-stat">
                                                    <p class="training-plan-stat-value">1500-2000</p>
                                                    <p class="training-plan-stat-label">D+/semaine</p>
                                                </div>
                                            </div>
                                            
                                            <p>Plan pour cyclistes intermédiaires visant à améliorer leur puissance et leur endurance.</p>
                                            
                                            <div class="training-plan-progress">
                                                <div class="training-plan-progress-bar" style="width: 0%"></div>
                                            </div>
                                            <p class="text-center">Progression: 0%</p>
                                            
                                            <a href="#" class="btn btn-primary btn-block">Commencer</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="upcoming-sessions mt-4">
                                <h3>Prochaines séances</h3>
                                <div class="session-card">
                                    <div class="session-date">
                                        <span class="session-day">Ven</span>
                                        <span class="session-number">04</span>
                                    </div>
                                    <div class="session-details">
                                        <h4>Sortie endurance</h4>
                                        <p><i class="fas fa-clock"></i> 1h30 • <i class="fas fa-mountain"></i> 300m D+ • <i class="fas fa-tachometer-alt"></i> Z2</p>
                                        <p>Sortie à allure modérée pour développer l'endurance de base.</p>
                                    </div>
                                    <div class="session-actions">
                                        <button class="btn btn-sm btn-primary">Voir détails</button>
                                    </div>
                                </div>
                                
                                <div class="session-card">
                                    <div class="session-date">
                                        <span class="session-day">Sam</span>
                                        <span class="session-number">05</span>
                                    </div>
                                    <div class="session-details">
                                        <h4>Intervalles courts</h4>
                                        <p><i class="fas fa-clock"></i> 1h15 • <i class="fas fa-mountain"></i> 200m D+ • <i class="fas fa-tachometer-alt"></i> Z4-Z5</p>
                                        <p>Séance d'intervalles courts à haute intensité pour développer la puissance.</p>
                                    </div>
                                    <div class="session-actions">
                                        <button class="btn btn-sm btn-primary">Voir détails</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="progress-chart animate-fade-in-right">
                            <h3>Votre progression</h3>
                            <div class="chart-container">
                                <img src="images/chart-placeholder.png" alt="Graphique de progression" class="img-fluid">
                            </div>
                            
                            <div class="stats-summary mt-4">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="stat-card">
                                            <h4>Distance</h4>
                                            <p class="stat-value">1 250 km</p>
                                            <p class="stat-label">Cette année</p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-6">
                                        <div class="stat-card">
                                            <h4>Dénivelé</h4>
                                            <p class="stat-value">15 400 m</p>
                                            <p class="stat-label">Cette année</p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-6">
                                        <div class="stat-card">
                                            <h4>Temps</h4>
                                            <p class="stat-value">58h 30m</p>
                                            <p class="stat-label">Cette année</p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-6">
                                        <div class="stat-card">
                                            <h4>Sorties</h4>
                                            <p class="stat-value">42</p>
                                            <p class="stat-label">Cette année</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="strava-connect mt-4">
                                <p>Connectez-vous avec Strava pour synchroniser vos activités</p>
                                <button class="btn btn-accent btn-block">
                                    <i class="fab fa-strava"></i> Connecter Strava
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Community Section -->
        <section id="community" class="community-section section-padding">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Communauté</h2>
                    <p class="section-subtitle">Rejoignez les cyclistes de Velo-Altitude</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="upcoming-events animate-fade-in">
                            <h3>Événements à venir</h3>
                            
                            <div class="event-card d-flex">
                                <div class="event-date">
                                    <span class="event-month">AVR</span>
                                    <span class="event-day">15</span>
                                </div>
                                <div class="event-details">
                                    <h4>Randonnée des Trois Ballons</h4>
                                    <p><i class="fas fa-map-marker-alt"></i> Départ: Cernay</p>
                                    <p><i class="fas fa-road"></i> Distance: 120km • <i class="fas fa-mountain"></i> Dénivelé: 2500m</p>
                                    <p>Randonnée cycliste passant par les trois ballons des Vosges.</p>
                                    <button class="btn btn-sm btn-primary">S'inscrire</button>
                                </div>
                            </div>
                            
                            <div class="event-card d-flex">
                                <div class="event-date">
                                    <span class="event-month">MAI</span>
                                    <span class="event-day">08</span>
                                </div>
                                <div class="event-details">
                                    <h4>Cyclosportive des Vosges</h4>
                                    <p><i class="fas fa-map-marker-alt"></i> Départ: Gérardmer</p>
                                    <p><i class="fas fa-road"></i> Distance: 150km • <i class="fas fa-mountain"></i> Dénivelé: 3200m</p>
                                    <p>Épreuve chronométrée traversant les plus beaux cols des Vosges.</p>
                                    <button class="btn btn-sm btn-primary">S'inscrire</button>
                                </div>
                            </div>
                            
                            <div class="event-card d-flex">
                                <div class="event-date">
                                    <span class="event-month">JUN</span>
                                    <span class="event-day">12</span>
                                </div>
                                <div class="event-details">
                                    <h4>Sortie club Velo-Altitude</h4>
                                    <p><i class="fas fa-map-marker-alt"></i> Départ: Strasbourg</p>
                                    <p><i class="fas fa-road"></i> Distance: 80km • <i class="fas fa-mountain"></i> Dénivelé: 800m</p>
                                    <p>Sortie conviviale ouverte à tous les membres de la communauté.</p>
                                    <button class="btn btn-sm btn-primary">S'inscrire</button>
                                </div>
                            </div>
                            
                            <div class="text-center mt-4">
                                <a href="#" class="btn btn-primary">Voir tous les événements</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="forum-topics animate-fade-in-right">
                            <h3>Forum de discussion</h3>
                            
                            <div class="topic-card d-flex">
                                <div class="topic-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="topic-details">
                                    <h4>Conseils pour le Grand Ballon</h4>
                                    <p>Quelles sont les meilleures approches pour gravir le Grand Ballon ?</p>
                                    <p><i class="fas fa-user"></i> Par CyclisteVosgien • <i class="fas fa-clock"></i> Il y a 2 jours • <i class="fas fa-comment"></i> 15 réponses</p>
                                </div>
                            </div>
                            
                            <div class="topic-card d-flex">
                                <div class="topic-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="topic-details">
                                    <h4>Recherche partenaires d'entraînement</h4>
                                    <p>Je cherche des cyclistes pour m'entraîner régulièrement autour de Strasbourg.</p>
                                    <p><i class="fas fa-user"></i> Par AlsaceCyclo • <i class="fas fa-clock"></i> Il y a 3 jours • <i class="fas fa-comment"></i> 8 réponses</p>
                                </div>
                            </div>
                            
                            <div class="topic-card d-flex">
                                <div class="topic-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="topic-details">
                                    <h4>Avis sur les nouveaux itinéraires balisés</h4>
                                    <p>Que pensez-vous des nouveaux itinéraires cyclables balisés dans les Vosges du Nord ?</p>
                                    <p><i class="fas fa-user"></i> Par VéloAddict • <i class="fas fa-clock"></i> Il y a 5 jours • <i class="fas fa-comment"></i> 12 réponses</p>
                                </div>
                            </div>
                            
                            <div class="community-stats mt-4">
                                <div class="row">
                                    <div class="col-4 text-center">
                                        <div class="community-stat">
                                            <p class="stat-value">1 250</p>
                                            <p class="stat-label">Membres</p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-4 text-center">
                                        <div class="community-stat">
                                            <p class="stat-value">320</p>
                                            <p class="stat-label">Discussions</p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-4 text-center">
                                        <div class="community-stat">
                                            <p class="stat-value">45</p>
                                            <p class="stat-label">Événements</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center mt-4">
                                <a href="#" class="btn btn-primary">Accéder au forum</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assistant Section -->
        <section id="assistant" class="assistant-section section-padding bg-light">
            <div class="container">
                <div class="section-header text-center">
                    <h2 class="section-title">Assistant IA</h2>
                    <p class="section-subtitle">Votre conseiller cyclisme personnel</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="assistant-features animate-fade-in">
                            <h3>Fonctionnalités de l'assistant</h3>
                            
                            <div class="feature-list">
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-route"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h4>Recommandations d'itinéraires</h4>
                                        <p>Obtenez des suggestions d'itinéraires personnalisés en fonction de votre niveau et de vos préférences.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-dumbbell"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h4>Conseils d'entraînement</h4>
                                        <p>Recevez des conseils d'entraînement adaptés à vos objectifs et à votre progression.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-bicycle"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h4>Assistance technique</h4>
                                        <p>Posez des questions sur l'entretien de votre vélo, les réglages ou les équipements.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h4>Informations locales</h4>
                                        <p>Obtenez des informations sur les cols, les événements et les services cyclistes dans la région.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="assistant-cta mt-4">
                                <p>L'assistant IA est disponible 24/7 pour répondre à toutes vos questions sur le cyclisme dans le Grand Est.</p>
                                <button class="btn btn-primary">En savoir plus</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="assistant-chat animate-fade-in-right">
                            <div class="chat-header">
                                <h3><i class="fas fa-robot"></i> Assistant Velo-Altitude</h3>
                            </div>
                            
                            <div class="chat-messages">
                                <div class="message assistant-message">
                                    <p>Bonjour ! Je suis votre assistant cyclisme pour la région. Comment puis-je vous aider aujourd'hui ?</p>
                                </div>
                                
                                <div class="message user-message">
                                    <p>Bonjour, je cherche un itinéraire pour ce week-end. Je suis de niveau intermédiaire.</p>
                                </div>
                                
                                <div class="message assistant-message">
                                    <p>Bien sûr ! Pour un cycliste de niveau intermédiaire, je peux vous recommander plusieurs itinéraires dans la région. Avez-vous une préférence pour la distance et le dénivelé ?</p>
                                </div>
                                
                                <div class="message user-message">
                                    <p>Je cherche un parcours d'environ 80-100km avec un dénivelé modéré.</p>
                                </div>
                                
                                <div class="message assistant-message">
                                    <p>Parfait ! Voici trois suggestions :</p>
                                    <p>1. <strong>La Route des Crêtes</strong> : 85km, 1200m D+. Un classique qui vous fera découvrir les plus beaux panoramas des Vosges.</p>
                                    <p>2. <strong>Tour du Lac de Pierre-Percée</strong> : 95km, 950m D+. Un parcours varié avec de belles vues sur le lac.</p>
                                    <p>3. <strong>Circuit des Trois Vallées</strong> : 105km, 1400m D+. Un peu plus exigeant mais très récompensant.</p>
                                    <p>Souhaitez-vous plus de détails sur l'un de ces itinéraires ?</p>
                                </div>
                            </div>
                            
                            <div class="chat-input">
                                <input type="text" placeholder="Posez votre question ici..." class="form-control">
                                <button class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Newsletter Section -->
        <section class="newsletter-section section-padding">
            <div class="container">
                <div class="newsletter-container animate-fade-in">
                    <div class="row align-items-center">
                        <div class="col-lg-6">
                            <h2>Restez informé</h2>
                            <p>Inscrivez-vous à notre newsletter pour recevoir les dernières actualités, événements et conseils cyclistes de Velo-Altitude.</p>
                        </div>
                        <div class="col-lg-6">
                            <form class="newsletter-form">
                                <div class="input-group">
                                    <input type="email" class="form-control" placeholder="Votre adresse email">
                                    <button class="btn btn-primary" type="submit">S'inscrire</button>
                                </div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="privacy-check">
                                    <label class="form-check-label" for="privacy-check">
                                        J'accepte de recevoir la newsletter et j'ai lu la <a href="#">politique de confidentialité</a>
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="row">
                    <div class="col-md-4">
                        <div class="footer-section">
                            <h3 class="footer-title">Velo-Altitude</h3>
                            <p>Votre compagnon pour découvrir les plus beaux cols de montagne, suivre vos performances et rejoindre la communauté des cyclistes.</p>
                            <div class="social-links">
                                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                                <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                                <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                                <a href="#" aria-label="Strava"><i class="fab fa-strava"></i></a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-2">
                        <div class="footer-section">
                            <h3 class="footer-title">Navigation</h3>
                            <ul class="footer-links">
                                <li class="footer-link"><a href="#">Accueil</a></li>
                                <li class="footer-link"><a href="#cols-explorer">Cols</a></li>
                                <li class="footer-link"><a href="#weather">Météo</a></li>
                                <li class="footer-link"><a href="#training">Entraînement</a></li>
                                <li class="footer-link"><a href="#community">Communauté</a></li>
                                <li class="footer-link"><a href="#assistant">Assistant</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="footer-section">
                            <h3 class="footer-title">Ressources</h3>
                            <ul class="footer-links">
                                <li class="footer-link"><a href="#">Blog</a></li>
                                <li class="footer-link"><a href="#">Guides d'entraînement</a></li>
                                <li class="footer-link"><a href="#">Calendrier des événements</a></li>
                                <li class="footer-link"><a href="#">Carte des cols</a></li>
                                <li class="footer-link"><a href="#">FAQ</a></li>
                                <li class="footer-link"><a href="#">Support</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="footer-section">
                            <h3 class="footer-title">Préférences</h3>
                            <div class="theme-selector">
                                <p>Thème</p>
                                <div class="theme-options">
                                    <div class="theme-option standard active" data-theme="standard" title="Thème standard"></div>
                                    <div class="theme-option dark" data-theme="dark" title="Thème sombre"></div>
                                    <div class="theme-option senior" data-theme="senior" title="Thème senior"></div>
                                    <div class="theme-option eco" data-theme="eco" title="Thème économie d'énergie"></div>
                                    <div class="theme-option ride" data-theme="ride" title="Thème en selle"></div>
                                </div>
                            </div>
                            
                            <div class="language-selector mt-3">
                                <p>Langue</p>
                                <div class="language-options">
                                    <div class="language-option fr active">
                                        <span class="language-flag"></span>
                                        Français
                                    </div>
                                    <div class="language-option en">
                                        <span class="language-flag"></span>
                                        English
                                    </div>
                                    <div class="language-option de">
                                        <span class="language-flag"></span>
                                        Deutsch
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Velo-Altitude. Tous droits réservés.</p>
                <p>
                    <a href="#">Politique de confidentialité</a> |
                    <a href="#">Conditions d'utilisation</a> |
                    <a href="#">Mentions légales</a>
                </p>
            </div>
        </div>
    </footer>

    <!-- Back to top button -->
    <button class="btn btn-primary btn-floating" id="back-to-top" aria-label="Retour en haut">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- JavaScript -->
    <script src="visual-elements.js"></script>
    
    <!-- API Dependencies -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
    
    <!-- Cache Manager -->
    <script src="js/cache-manager.js"></script>
    
    <!-- Custom API Modules -->
    <script src="js/map.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/strava.js"></script>
    <script src="js/ai-assistant.js"></script>
    
    <!-- App Initialization -->
    <script>
        // Configuration globale
        const apiConfig = {
            mapbox: {
                token: '' // Sera récupéré depuis le serveur
            }
        };

        // État du tableau de bord
        const dashboardState = {
            layout: '2x2',
            widgets: ['map', 'weather', 'strava', 'ai-assistant'],
            expanded: null,
            initialized: {
                map: false,
                weather: false,
                strava: false,
                aiAssistant: false
            }
        };

        // Gestion du chargement progressif
        let loadingStatus = {
            dependencies: false,
            mapbox: false,
            weather: false,
            strava: false,
            aiAssistant: false
        };

        // Éléments de l'interface
        const elements = {
            dashboard: document.getElementById('dashboard-container'),
            mapContainer: document.getElementById('map-container'),
            weatherContainer: document.getElementById('weather-widget-container'),
            forecastContainer: document.getElementById('weather-forecast-container'),
            stravaAuthBtn: document.getElementById('strava-auth-btn'),
            stravaActivities: document.getElementById('strava-activities-container'),
            stravaStats: document.getElementById('strava-stats-container'),
            aiChat: document.getElementById('ai-chat-container'),
            aiChatInput: document.getElementById('ai-chat-input'),
            aiChatSend: document.getElementById('ai-chat-send'),
            aiSuggestions: document.getElementById('ai-suggestions-container'),
            customizeBtn: document.querySelector('.dashboard-customize-btn'),
            customizeModal: document.getElementById('customize-modal'),
            closeCustomize: document.getElementById('close-customize'),
            saveCustomize: document.getElementById('save-customize'),
            resetCustomize: document.getElementById('reset-customize')
        };

        // Fonction principale d'initialisation
        async function initDashboard() {
            showLoadingState('Initialisation du tableau de bord...');
            
            // Récupérer les configurations depuis le serveur
            try {
                const configResponse = await fetch('/api/config');
                if (configResponse.ok) {
                    const config = await configResponse.json();
                    if (config.mapbox && config.mapbox.token) {
                        apiConfig.mapbox.token = config.mapbox.token;
                    }
                }
            } catch (error) {
                console.error('Erreur lors de la récupération de la configuration:', error);
            }
            
            // Configurer le gestionnaire de cache
            CacheManager.configure({
                defaultTTL: 1800, // 30 minutes par défaut
                ttlConfig: {
                    weather: 900,       // 15 minutes pour les données météo en test
                    routes: 3600,       // 1 heure pour les itinéraires calculés
                    stravaActivities: 900  // 15 minutes pour les activités Strava
                }
            });
            
            // Afficher les statistiques du cache dans la console
            console.log('Statistiques du cache:', CacheManager.getStats());
            
            // Charger les préférences utilisateur depuis le localStorage
            loadUserPreferences();
            
            // Initialiser l'interface du tableau de bord
            initDashboardUI();
            
            // Initialiser les modules dans l'ordre optimal
            await initMapModule();
            
            // Initialiser les autres modules en parallèle
            Promise.all([
                initWeatherModule(),
                initStravaModule(),
                initAIAssistantModule()
            ]).then(() => {
                // Tout est chargé
                hideLoadingState();
                console.log('Tous les modules sont chargés');
            }).catch(error => {
                console.error('Erreur lors de l\'initialisation des modules:', error);
                hideLoadingState();
            });
        }

        // Initialisation du module de carte
        async function initMapModule() {
            if (!elements.mapContainer) return;
            
            showModuleLoading('map', 'Chargement de la carte...');
            
            try {
                // Vérifier si le token Mapbox est disponible
                if (!apiConfig.mapbox.token) {
                    throw new Error('Token Mapbox non disponible');
                }
                
                // Initialiser la carte
                window.cyclingMap.initMap('map-container', apiConfig.mapbox.token);
                
                // Configurer les contrôles de route
                const routeBtn = document.querySelector('.calculate-route-btn');
                if (routeBtn) {
                    routeBtn.addEventListener('click', showRouteCalculator);
                }
                
                const isochroneBtn = document.querySelector('.calculate-isochrone-btn');
                if (isochroneBtn) {
                    isochroneBtn.addEventListener('click', showIsochroneCalculator);
                }
                
                dashboardState.initialized.map = true;
                hideModuleLoading('map');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de la carte:', error);
                showModuleError('map', 'Impossible de charger la carte. Veuillez réessayer.');
            }
        }

        // Initialisation du module météo
        async function initWeatherModule() {
            if (!elements.weatherContainer || !elements.forecastContainer) return;
            
            showModuleLoading('weather', 'Chargement des données météo...');
            
            try {
                // Initialiser le module météo
                window.weatherModule.initWeather('weather-widget-container', 'weather-forecast-container');
                
                dashboardState.initialized.weather = true;
                hideModuleLoading('weather');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de la météo:', error);
                showModuleError('weather', 'Impossible de charger les données météo. Veuillez réessayer.');
            }
        }

        // Initialisation du module Strava
        async function initStravaModule() {
            if (!elements.stravaAuthBtn || !elements.stravaActivities || !elements.stravaStats) return;
            
            showModuleLoading('strava', 'Chargement des données Strava...');
            
            try {
                // Initialiser le module Strava
                window.stravaIntegration.initStrava('strava-auth-btn', 'strava-activities-container', 'strava-stats-container');
                
                dashboardState.initialized.strava = true;
                hideModuleLoading('strava');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de Strava:', error);
                showModuleError('strava', 'Impossible de charger les données Strava. Veuillez réessayer.');
            }
        }

        // Initialisation du module Assistant IA
        async function initAIAssistantModule() {
            if (!elements.aiChat || !elements.aiChatInput || !elements.aiChatSend || !elements.aiSuggestions) return;
            
            showModuleLoading('ai-assistant', 'Initialisation de l\'assistant IA...');
            
            try {
                // Initialiser le module assistant IA
                window.aiAssistant.initAIAssistant('ai-chat-container', 'ai-chat-input', 'ai-chat-send', 'ai-suggestions-container');
                
                dashboardState.initialized.aiAssistant = true;
                hideModuleLoading('ai-assistant');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de l\'assistant IA:', error);
                showModuleError('ai-assistant', 'Impossible d\'initialiser l\'assistant IA. Veuillez réessayer.');
            }
        }

        // Initialisation de l'interface du tableau de bord
        function initDashboardUI() {
            // Configurer le modal de personnalisation
            if (elements.customizeBtn && elements.customizeModal) {
                elements.customizeBtn.addEventListener('click', () => {
                    elements.customizeModal.style.display = 'flex';
                });
                
                elements.closeCustomize.addEventListener('click', () => {
                    elements.customizeModal.style.display = 'none';
                });
                
                elements.saveCustomize.addEventListener('click', () => {
                    saveUserPreferences();
                    applyDashboardLayout();
                    elements.customizeModal.style.display = 'none';
                });
                
                elements.resetCustomize.addEventListener('click', () => {
                    resetUserPreferences();
                    updateCustomizeUI();
                });
            }
            
            // Configurer les options de vue
            const viewButtons = document.querySelectorAll('.dashboard-view-options button');
            viewButtons.forEach(button => {
                button.addEventListener('click', () => {
                    viewButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    const view = button.getAttribute('data-view');
                    elements.dashboard.className = `dashboard-${view}`;
                });
            });
            
            // Configurer les widgets
            const widgets = document.querySelectorAll('.dashboard-widget');
            widgets.forEach(widget => {
                const widgetType = widget.getAttribute('data-widget');
                const expandBtn = widget.querySelector('.widget-expand');
                const refreshBtn = widget.querySelector('.widget-refresh');
                
                if (expandBtn) {
                    expandBtn.addEventListener('click', () => {
                        toggleWidgetExpand(widgetType);
                    });
                }
                
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        refreshWidget(widgetType);
                    });
                }
            });
            
            // Rendre les widgets réorganisables
            const orderList = document.getElementById('widget-order-list');
            if (orderList) {
                // Ici on pourrait implémenter une bibliothèque de drag-and-drop comme SortableJS
                // Pour simplifier, on utilisera une approche plus basique
                const items = orderList.querySelectorAll('li');
                items.forEach((item, index) => {
                    item.addEventListener('click', () => {
                        if (index > 0) {
                            // Monter l'élément
                            const prevItem = items[index - 1];
                            orderList.insertBefore(item, prevItem);
                            updateOrderNumbers();
                        }
                    });
                    
                    item.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        if (index < items.length - 1) {
                            // Descendre l'élément
                            const nextItem = items[index + 1];
                            orderList.insertBefore(nextItem, item);
                            updateOrderNumbers();
                        }
                    });
                });
            }
            
            // Configurer l'état initial
            applyDashboardLayout();
        }

        // Gestionnaires pour fonctionnalités spécifiques
        function showRouteCalculator() {
            // Créer un modal pour saisir les points de départ et d'arrivée
            const modal = document.createElement('div');
            modal.className = 'route-calculator-modal';
            modal.innerHTML = `
                <div class="route-calculator-content">
                    <div class="route-calculator-header">
                        <h3>Calculer un itinéraire</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="route-calculator-body">
                        <div class="form-group">
                            <label for="start-point">Point de départ</label>
                            <input type="text" id="start-point" class="form-control" placeholder="Coordonnées ou adresse">
                        </div>
                        <div class="form-group">
                            <label for="end-point">Point d'arrivée</label>
                            <input type="text" id="end-point" class="form-control" placeholder="Coordonnées ou adresse">
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="avoid-hills" class="form-check-input">
                            <label for="avoid-hills" class="form-check-label">Éviter les dénivelés importants</label>
                        </div>
                    </div>
                    <div class="route-calculator-footer">
                        <button class="btn btn-primary calculate-btn">Calculer</button>
                        <button class="btn btn-secondary cancel-btn">Annuler</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Configurer les gestionnaires d'événements
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-btn');
            const calculateBtn = modal.querySelector('.calculate-btn');
            
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            calculateBtn.addEventListener('click', () => {
                const startPoint = modal.querySelector('#start-point').value;
                const endPoint = modal.querySelector('#end-point').value;
                const avoidHills = modal.querySelector('#avoid-hills').checked;
                
                // Ici, on devrait géocoder les adresses en coordonnées
                // Pour simplifier, on suppose que les entrées sont des coordonnées
                const startCoords = parseCoordinates(startPoint);
                const endCoords = parseCoordinates(endPoint);
                
                if (startCoords && endCoords) {
                    // Calculer l'itinéraire
                    window.cyclingMap.calculateRoute(startCoords, endCoords)
                        .then(route => {
                            console.log('Itinéraire calculé:', route);
                            document.body.removeChild(modal);
                        })
                        .catch(error => {
                            console.error('Erreur lors du calcul de l\'itinéraire:', error);
                            alert('Erreur lors du calcul de l\'itinéraire. Veuillez réessayer.');
                        });
                } else {
                    alert('Veuillez entrer des coordonnées valides (format: lat,lng)');
                }
            });
        }

        function showIsochroneCalculator() {
            // Créer un modal pour saisir le point central et le temps
            const modal = document.createElement('div');
            modal.className = 'isochrone-calculator-modal';
            modal.innerHTML = `
                <div class="isochrone-calculator-content">
                    <div class="isochrone-calculator-header">
                        <h3>Calculer une zone cyclable</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="isochrone-calculator-body">
                        <div class="form-group">
                            <label for="center-point">Point central</label>
                            <input type="text" id="center-point" class="form-control" placeholder="Coordonnées ou adresse">
                        </div>
                        <div class="form-group">
                            <label for="time-range">Temps (en minutes)</label>
                            <input type="range" id="time-range" class="form-control" min="5" max="60" step="5" value="30">
                            <output for="time-range" id="time-output">30 minutes</output>
                        </div>
                        <div class="form-group">
                            <label for="range-type">Type de portée</label>
                            <select id="range-type" class="form-control">
                                <option value="time">Temps</option>
                                <option value="distance">Distance</option>
                            </select>
                        </div>
                    </div>
                    <div class="isochrone-calculator-footer">
                        <button class="btn btn-primary calculate-btn">Calculer</button>
                        <button class="btn btn-secondary cancel-btn">Annuler</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Configurer les gestionnaires d'événements
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-btn');
            const calculateBtn = modal.querySelector('.calculate-btn');
            const timeRange = modal.querySelector('#time-range');
            const timeOutput = modal.querySelector('#time-output');
            
            timeRange.addEventListener('input', () => {
                timeOutput.textContent = `${timeRange.value} minutes`;
            });
            
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            calculateBtn.addEventListener('click', () => {
                const centerPoint = modal.querySelector('#center-point').value;
                const time = parseInt(modal.querySelector('#time-range').value);
                const rangeType = modal.querySelector('#range-type').value;
                
                // Ici, on devrait géocoder l'adresse en coordonnées
                // Pour simplifier, on suppose que l'entrée est des coordonnées
                const centerCoords = parseCoordinates(centerPoint);
                
                if (centerCoords) {
                    // Calculer l'isochrone
                    window.cyclingMap.calculateIsochrone(centerCoords, time, rangeType)
                        .then(isochrone => {
                            console.log('Isochrone calculé:', isochrone);
                            document.body.removeChild(modal);
                        })
                        .catch(error => {
                            console.error('Erreur lors du calcul de l\'isochrone:', error);
                            alert('Erreur lors du calcul de la zone cyclable. Veuillez réessayer.');
                        });
                } else {
                    alert('Veuillez entrer des coordonnées valides (format: lat,lng)');
                }
            });
        }

        // Utilitaires
        function parseCoordinates(coordString) {
            if (!coordString) return null;
            
            // Format attendu: "lat,lng" ou "[lat, lng]"
            const sanitized = coordString.replace(/[\[\]]/g, '').trim();
            const parts = sanitized.split(',').map(part => parseFloat(part.trim()));
            
            if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                return parts;
            }
            
            return null;
        }

        function toggleWidgetExpand(widgetType) {
            const widget = document.querySelector(`.dashboard-widget[data-widget="${widgetType}"]`);
            
            if (!widget) return;
            
            if (dashboardState.expanded === widgetType) {
                // Réduire le widget
                widget.classList.remove('expanded');
                dashboardState.expanded = null;
                
                // Réafficher les autres widgets
                document.querySelectorAll('.dashboard-widget').forEach(w => {
                    w.style.display = '';
                });
            } else {
                // Étendre le widget
                widget.classList.add('expanded');
                dashboardState.expanded = widgetType;
                
                // Masquer les autres widgets
                document.querySelectorAll('.dashboard-widget').forEach(w => {
                    if (w !== widget) {
                        w.style.display = 'none';
                    }
                });
            }
        }

        function refreshWidget(widgetType) {
            switch (widgetType) {
                case 'map':
                    // Rafraîchir la carte
                    if (window.mapInstance) {
                        window.mapInstance.resize();
                    }
                    break;
                    
                case 'weather':
                    // Rafraîchir les données météo
                    if (window.weatherModule) {
                        const lat = 48.6833;
                        const lon = 6.2;
                        window.weatherModule.fetchCurrentWeather(lat, lon)
                            .then(data => window.weatherModule.updateWeatherWidget('weather-widget-container', data));
                        window.weatherModule.fetchWeatherForecast(lat, lon)
                            .then(data => window.weatherModule.displayWeatherForecast('weather-forecast-container', data));
                    }
                    break;
                    
                case 'strava':
                    // Rafraîchir les données Strava
                    if (window.stravaIntegration) {
                        window.stravaIntegration.fetchActivities('strava-activities-container');
                        window.stravaIntegration.fetchAthleteStats('strava-stats-container');
                    }
                    break;
                    
                case 'ai-assistant':
                    // Rafraîchir l'assistant (réinitialiser la conversation)
                    if (window.aiAssistant) {
                        window.aiAssistant.initAIAssistant('ai-chat-container', 'ai-chat-input', 'ai-chat-send', 'ai-suggestions-container');
                    }
                    break;
            }
        }

        function updateOrderNumbers() {
            const orderList = document.getElementById('widget-order-list');
            if (!orderList) return;
            
            const items = orderList.querySelectorAll('li');
            items.forEach((item, index) => {
                const widgetType = item.getAttribute('data-widget');
                const widgetName = getWidgetDisplayName(widgetType);
                item.textContent = `${index + 1}. ${widgetName}`;
                item.setAttribute('data-widget', widgetType);
            });
        }

        function getWidgetDisplayName(widgetType) {
            switch (widgetType) {
                case 'map': return 'Carte & Itinéraires';
                case 'weather': return 'Météo Cycliste';
                case 'strava': return 'Activités Strava';
                case 'ai-assistant': return 'Assistant Cyclisme';
                default: return widgetType;
            }
        }

        function showLoadingState(message) {
            // Créer un élément de chargement global s'il n'existe pas déjà
            let loader = document.getElementById('dashboard-loader');
            if (!loader) {
                loader = document.createElement('div');
                loader.id = 'dashboard-loader';
                loader.className = 'dashboard-loader';
                loader.innerHTML = `
                    <div class="loading-spinner"></div>
                    <p class="loading-message">${message || 'Chargement...'}</p>
                `;
                document.body.appendChild(loader);
            } else {
                loader.querySelector('.loading-message').textContent = message || 'Chargement...';
            }
            
            loader.style.display = 'flex';
        }

        function hideLoadingState() {
            const loader = document.getElementById('dashboard-loader');
            if (loader) {
                loader.style.display = 'none';
            }
        }

        function showModuleLoading(moduleId, message) {
            const widget = document.querySelector(`.dashboard-widget[data-widget="${moduleId}"]`);
            if (!widget) return;
            
            const widgetBody = widget.querySelector('.widget-body');
            if (!widgetBody) return;
            
            // Créer un élément de chargement pour le module
            let loader = widgetBody.querySelector('.module-loader');
            if (!loader) {
                loader = document.createElement('div');
                loader.className = 'module-loader';
                loader.innerHTML = `
                    <div class="loading-spinner small"></div>
                    <p class="loading-message">${message || 'Chargement...'}</p>
                `;
                widgetBody.appendChild(loader);
            } else {
                loader.querySelector('.loading-message').textContent = message || 'Chargement...';
            }
            
            loader.style.display = 'flex';
        }

        function hideModuleLoading(moduleId) {
            const widget = document.querySelector(`.dashboard-widget[data-widget="${moduleId}"]`);
            if (!widget) return;
            
            const loader = widget.querySelector('.module-loader');
            if (loader) {
                loader.style.display = 'none';
            }
        }

        function showModuleError(moduleId, errorMessage) {
            const widget = document.querySelector(`.dashboard-widget[data-widget="${moduleId}"]`);
            if (!widget) return;
            
            const widgetBody = widget.querySelector('.widget-body');
            if (!widgetBody) return;
            
            // Créer un élément d'erreur pour le module
            let errorElement = widgetBody.querySelector('.module-error');
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.className = 'module-error';
                errorElement.innerHTML = `
                    <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <p class="error-message">${errorMessage}</p>
                    <button class="btn btn-sm btn-primary retry-btn">Réessayer</button>
                `;
                widgetBody.appendChild(errorElement);
                
                // Configurer le bouton de réessai
                const retryBtn = errorElement.querySelector('.retry-btn');
                retryBtn.addEventListener('click', () => {
                    hideModuleError(moduleId);
                    refreshWidget(moduleId);
                });
            } else {
                errorElement.querySelector('.error-message').textContent = errorMessage;
            }
            
            errorElement.style.display = 'flex';
        }

        function hideModuleError(moduleId) {
            const widget = document.querySelector(`.dashboard-widget[data-widget="${moduleId}"]`);
            if (!widget) return;
            
            const errorElement = widget.querySelector('.module-error');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }

        function loadUserPreferences() {
            try {
                const savedPreferences = localStorage.getItem('dashboardPreferences');
                if (savedPreferences) {
                    const preferences = JSON.parse(savedPreferences);
                    dashboardState.layout = preferences.layout || '2x2';
                    dashboardState.widgets = preferences.widgets || ['map', 'weather', 'strava', 'ai-assistant'];
                }
            } catch (error) {
                console.error('Erreur lors du chargement des préférences:', error);
            }
            
            updateCustomizeUI();
        }

        function saveUserPreferences() {
            // Récupérer les widgets actifs
            const activeWidgets = [];
            document.querySelectorAll('.widget-option input:checked').forEach(checkbox => {
                const widgetType = checkbox.parentElement.getAttribute('data-widget');
                activeWidgets.push(widgetType);
            });
            
            // Récupérer la mise en page sélectionnée
            const layoutOption = document.querySelector('.layout-option input:checked');
            const layout = layoutOption ? layoutOption.parentElement.getAttribute('data-layout') : '2x2';
            
            // Récupérer l'ordre des widgets
            const orderList = document.getElementById('widget-order-list');
            const orderedWidgets = [];
            if (orderList) {
                orderList.querySelectorAll('li').forEach(item => {
                    const widgetType = item.getAttribute('data-widget');
                    orderedWidgets.push(widgetType);
                });
            }
            
            // Mettre à jour l'état du tableau de bord
            dashboardState.layout = layout;
            dashboardState.widgets = orderedWidgets.filter(widget => activeWidgets.includes(widget));
            
            // Enregistrer dans le localStorage
            try {
                localStorage.setItem('dashboardPreferences', JSON.stringify({
                    layout: dashboardState.layout,
                    widgets: dashboardState.widgets
                }));
            } catch (error) {
                console.error('Erreur lors de l\'enregistrement des préférences:', error);
            }
        }

        function resetUserPreferences() {
            dashboardState.layout = '2x2';
            dashboardState.widgets = ['map', 'weather', 'strava', 'ai-assistant'];
            
            try {
                localStorage.removeItem('dashboardPreferences');
            } catch (error) {
                console.error('Erreur lors de la réinitialisation des préférences:', error);
            }
            
            updateCustomizeUI();
        }

        function updateCustomizeUI() {
            // Mettre à jour les cases à cocher des widgets
            document.querySelectorAll('.widget-option input').forEach(checkbox => {
                const widgetType = checkbox.parentElement.getAttribute('data-widget');
                checkbox.checked = dashboardState.widgets.includes(widgetType);
            });
            
            // Mettre à jour les options de mise en page
            document.querySelectorAll('.layout-option input').forEach(radio => {
                const layout = radio.parentElement.getAttribute('data-layout');
                radio.checked = layout === dashboardState.layout;
            });
            
            // Mettre à jour l'ordre des widgets
            const orderList = document.getElementById('widget-order-list');
            if (orderList) {
                orderList.innerHTML = '';
                dashboardState.widgets.forEach((widget, index) => {
                    const item = document.createElement('li');
                    item.setAttribute('data-widget', widget);
                    item.textContent = `${index + 1}. ${getWidgetDisplayName(widget)}`;
                    orderList.appendChild(item);
                });
            }
        }

        function applyDashboardLayout() {
            const dashboard = document.getElementById('dashboard-container');
            if (!dashboard) return;
            
            // Appliquer la classe de mise en page
            dashboard.className = `dashboard-grid layout-${dashboardState.layout}`;
            
            // Afficher/masquer les widgets selon les préférences
            document.querySelectorAll('.dashboard-widget').forEach(widget => {
                const widgetType = widget.getAttribute('data-widget');
                if (dashboardState.widgets.includes(widgetType)) {
                    widget.style.display = '';
                    
                    // Réordonner les widgets
                    const index = dashboardState.widgets.indexOf(widgetType);
                    widget.style.order = index;
                } else {
                    widget.style.display = 'none';
                }
            });
        }

        // Démarrer l'initialisation lorsque le DOM est chargé
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
