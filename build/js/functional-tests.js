const FunctionalTests=function(){const e={results:[],runningTest:null,completedTests:0,failedTests:0,startTime:null},t=!0,n=!1,s=1e3,a=1e4;function o(e,n=null){if(!t)return;i();const s=document.createElement("div");if(s.className="visual-indicator",s.textContent=e,s.style.top="70px",s.style.left="50%",s.style.transform="translateX(-50%)",document.body.appendChild(s),n){const e=n.getBoundingClientRect(),t=document.createElement("div");t.className="test-target-highlight",t.style.top=`${e.top+window.scrollY}px`,t.style.left=`${e.left+window.scrollX}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,document.body.appendChild(t)}setTimeout(i,3e3)}function i(){document.querySelectorAll(".visual-indicator, .test-target-highlight").forEach((e=>{document.body.removeChild(e)}))}function r(){const t=document.getElementById("test-results-container"),n=document.getElementById("test-progress-fill"),s=document.getElementById("test-summary-text"),a=document.getElementById("test-time"),o=e.results.length,i=e.completedTests,r=o>0?i/o*100:0;if(n.style.width=`${r}%`,s.textContent=`${i}/${o} tests ex\xe9cut\xe9s (${e.failedTests} \xe9checs)`,e.startTime){const t=Math.round((Date.now()-e.startTime)/1e3);a.textContent=`Dur\xe9e: ${t}s`}if(t.innerHTML="",e.results.forEach((e=>{const n=document.createElement("div");n.className=`test-item ${e.status}`,n.innerHTML=`\n        <div class="test-item-header">\n          <div class="test-name">${e.name}</div>\n          <div class="test-status">${e.status}</div>\n        </div>\n        <div class="test-message">${e.message||""}</div>\n        ${e.details?`<div class="test-details">${e.details}</div>`:""}\n      `,t.appendChild(n)})),e.runningTest){const e=document.querySelectorAll(".test-item.running");e.length>0&&e[0].scrollIntoView({behavior:"smooth",block:"nearest"})}}function c(){e.results=[],e.completedTests=0,e.failedTests=0,e.startTime=Date.now(),document.getElementById("functional-tests-ui").style.display="flex",document.getElementById("toggle-test-ui").textContent="Masquer",r();[{name:"Chargement de la carte",fn:m},{name:"Marqueurs des cols",fn:p},{name:"Calcul d'itin\xe9raire",fn:f},{name:"Affichage du profil d'\xe9l\xe9vation",fn:g},{name:"Fonction d'isochrone",fn:h},{name:"R\xe9cup\xe9ration des donn\xe9es m\xe9t\xe9o actuelles",fn:testCurrentWeather},{name:"Affichage des pr\xe9visions",fn:testWeatherForecast},{name:"\xc9valuation des conditions cyclables",fn:testCyclingConditions},{name:"Authentification Strava",fn:testStravaAuth},{name:"R\xe9cup\xe9ration des activit\xe9s",fn:testStravaActivities},{name:"Affichage des statistiques d'athl\xe8te",fn:testAthleteStats},{name:"Initialisation de l'assistant",fn:testAIInitialization},{name:"Requ\xeates \xe0 l'assistant",fn:testAIRequests},{name:"Suggestions intelligentes",fn:testAISuggestions},{name:"Int\xe9gration M\xe9t\xe9o-Carte",fn:x},{name:"Int\xe9gration Strava-Carte",fn:testStravaMapIntegration},{name:"Int\xe9gration IA-Tous les modules",fn:testAIIntegration},{name:"Cache des donn\xe9es m\xe9t\xe9o",fn:testWeatherCache},{name:"Cache des itin\xe9raires",fn:testRouteCache},{name:"Cache des donn\xe9es Strava",fn:testStravaCache}].forEach((t=>{e.results.push({name:t.name,status:"pending",message:"En attente d'ex\xe9cution",fn:t.fn})})),r(),d()}function l(){const t=e.results.filter((e=>"failure"===e.status));0!==t.length&&(e.completedTests-=t.length,e.failedTests=0,e.startTime=Date.now(),t.forEach((e=>{e.status="pending",e.message="En attente d'ex\xe9cution",e.details=null})),r(),d())}function d(){const t=e.results.find((e=>"pending"===e.status));if(!t)return e.runningTest=null,void r();t.status="running",t.message="Ex\xe9cution en cours...",e.runningTest=t,r();const n=setTimeout((()=>{u(t,!1,"Test timeout apr\xe8s "+a+"ms")}),a);try{const e=t.fn();e&&"function"===typeof e.then?e.then((e=>{clearTimeout(n),u(t,e.success,e.message,e.details)})).catch((e=>{clearTimeout(n),u(t,!1,"Erreur pendant l'ex\xe9cution du test",e.toString())})):(clearTimeout(n),u(t,!0,"Test compl\xe9t\xe9 avec succ\xe8s"))}catch(s){clearTimeout(n),u(t,!1,"Exception pendant l'ex\xe9cution du test",s.toString())}}function u(t,n,a,o=null){t.status=n?"success":"failure",t.message=a,t.details=o,e.completedTests++,n||e.failedTests++,e.runningTest=null,r(),setTimeout(d,s)}function m(){return new Promise((e=>{if(o("Test du chargement de la carte...",elements.mapContainer),window.mapInstance)return void e({success:!0,message:"La carte est d\xe9j\xe0 charg\xe9e et pr\xeate"});const t=setTimeout((()=>{document.removeEventListener("mapReady",n),e({success:!1,message:"\xc9chec du chargement de la carte dans le d\xe9lai imparti",details:"L'\xe9v\xe9nement mapReady n'a pas \xe9t\xe9 d\xe9clench\xe9 dans les 5 secondes."})}),5e3),n=()=>{if(clearTimeout(t),window.mapInstance&&"function"===typeof window.mapInstance.getCenter){const t=window.mapInstance.getCenter(),n=window.mapInstance.getZoom();e({success:!0,message:"La carte s'est charg\xe9e correctement",details:`Centre: [${t.lng.toFixed(4)}, ${t.lat.toFixed(4)}], Zoom: ${n}`})}else e({success:!1,message:"La carte s'est charg\xe9e mais l'instance n'est pas correctement initialis\xe9e",details:"mapInstance: "+typeof window.mapInstance})};document.addEventListener("mapReady",n)}))}function p(){return new Promise((e=>{o("Test des marqueurs de cols...",elements.mapContainer),window.mapInstance?setTimeout((()=>{const t=document.querySelectorAll(".cycling-marker");t.length>0?e({success:!0,message:`${t.length} marqueurs de cols trouv\xe9s sur la carte`,details:"Les marqueurs sont correctement affich\xe9s avec leur style personnalis\xe9."}):e({success:!1,message:"Aucun marqueur de col trouv\xe9 sur la carte",details:"La fonction addCyclingMarkers() n'a peut-\xeatre pas \xe9t\xe9 appel\xe9e ou a \xe9chou\xe9."})}),2e3):e({success:!1,message:"La carte n'est pas charg\xe9e, impossible de tester les marqueurs",details:"Ex\xe9cutez d'abord le test de chargement de la carte."})}))}function f(){return new Promise((e=>{if(o("Test du calcul d'itin\xe9raire...",elements.mapContainer),!window.mapInstance)return void e({success:!1,message:"La carte n'est pas charg\xe9e, impossible de tester le calcul d'itin\xe9raire",details:"Ex\xe9cutez d'abord le test de chargement de la carte."});if("function"!==typeof window.calculateRoute)return void e({success:!1,message:"La fonction calculateRoute n'est pas disponible",details:"V\xe9rifiez que la fonction est export\xe9e correctement dans le module map.js."});const t=[6.877,48.1],n=[7.2511,48.5734];try{const s=window.calculateRoute(t,n);s&&"function"===typeof s.then?s.then((t=>{if(t&&t.routes&&t.routes.length>0){const n=t.routes[0];e({success:!0,message:"Itin\xe9raire calcul\xe9 avec succ\xe8s",details:`Distance: ${(n.distance/1e3).toFixed(1)} km, Dur\xe9e: ${Math.round(n.duration/60)} min`})}else e({success:!1,message:"\xc9chec du calcul d'itin\xe9raire, aucune route retourn\xe9e",details:JSON.stringify(t)})})).catch((t=>{e({success:!1,message:"Erreur lors du calcul d'itin\xe9raire",details:t.toString()})})):e({success:!1,message:"La fonction calculateRoute ne retourne pas une promesse valide",details:"Type retourn\xe9: "+typeof s})}catch(s){e({success:!1,message:"Exception lors du calcul d'itin\xe9raire",details:s.toString()})}}))}function g(){return new Promise((e=>{if(o("Test du profil d'\xe9l\xe9vation..."),"function"===typeof window.showElevationProfile)try{const t="colDeLaSchlucht",n=[7.0011,48.0539];window.showElevationProfile(t,n),setTimeout((()=>{const t=document.querySelector(".elevation-profile-modal");if(t){const n=t.querySelector(".elevation-profile-header h3"),s=t.querySelector("#elevation-chart"),a=t.querySelector("#elevation-route-select");if(n&&s&&a){const n=t.querySelector(".close-modal");n&&n.click(),e({success:!0,message:"Le profil d'\xe9l\xe9vation s'affiche correctement",details:"Tous les \xe9l\xe9ments du profil sont pr\xe9sents: en-t\xeate, graphique et s\xe9lecteur de versant."})}else e({success:!1,message:"Certains \xe9l\xe9ments du profil d'\xe9l\xe9vation sont manquants",details:`\n                  En-t\xeate: ${n?"OK":"Manquant"}\n                  Graphique: ${s?"OK":"Manquant"}\n                  S\xe9lecteur: ${a?"OK":"Manquant"}\n                `})}else e({success:!1,message:"La modal du profil d'\xe9l\xe9vation n'appara\xeet pas",details:"La fonction showElevationProfile a \xe9t\xe9 appel\xe9e mais n'a pas cr\xe9\xe9 la modal attendue."})}),2e3)}catch(t){e({success:!1,message:"Exception lors de l'affichage du profil d'\xe9l\xe9vation",details:t.toString()})}else e({success:!1,message:"La fonction showElevationProfile n'est pas disponible",details:"V\xe9rifiez que la fonction est export\xe9e correctement dans le module map.js."})}))}function h(){return new Promise((e=>{if(o("Test de la fonction d'isochrone...",elements.mapContainer),window.mapInstance)if("function"===typeof window.showIsochrone)try{const t=[6.877,48.1],n=30,s=window.showIsochrone(t,n);s&&"function"===typeof s.then?s.then((s=>{setTimeout((()=>{document.querySelectorAll(".mapboxgl-canvas-container .mapboxgl-canvas").length>0?e({success:!0,message:"L'isochrone s'affiche correctement sur la carte",details:`Isochrone calcul\xe9 pour ${n} minutes de trajet depuis le point [${t[0].toFixed(4)}, ${t[1].toFixed(4)}]`}):e({success:!1,message:"L'isochrone ne s'affiche pas sur la carte",details:"La fonction showIsochrone a \xe9t\xe9 appel\xe9e mais n'a pas ajout\xe9 la couche attendue."})}),2e3)})).catch((t=>{e({success:!1,message:"Erreur lors du calcul de l'isochrone",details:t.toString()})})):e({success:!1,message:"La fonction showIsochrone ne retourne pas une promesse valide",details:"Type retourn\xe9: "+typeof s})}catch(t){e({success:!1,message:"Exception lors du calcul de l'isochrone",details:t.toString()})}else e({success:!1,message:"La fonction showIsochrone n'est pas disponible",details:"V\xe9rifiez que la fonction est export\xe9e correctement dans le module map.js."});else e({success:!1,message:"La carte n'est pas charg\xe9e, impossible de tester la fonction d'isochrone",details:"Ex\xe9cutez d'abord le test de chargement de la carte."})}))}function x(){return new Promise((e=>{if(o("Test de l'int\xe9gration m\xe9t\xe9o-carte..."),window.mapInstance)if(window.weatherModule&&"function"===typeof window.weatherModule.fetchCurrentWeather)try{const t=document.querySelectorAll(".cycling-marker");if(0===t.length)return void e({success:!1,message:"Aucun marqueur de col trouv\xe9 pour tester l'int\xe9gration m\xe9t\xe9o",details:"Les marqueurs de cols doivent \xeatre ajout\xe9s \xe0 la carte avant de tester l'int\xe9gration m\xe9t\xe9o."});t[0].click(),setTimeout((()=>{const t=document.querySelector(".mapboxgl-popup");if(!t)return void e({success:!1,message:"Le popup du col ne s'affiche pas apr\xe8s le clic",details:"V\xe9rifiez la gestion des \xe9v\xe9nements de clic sur les marqueurs."});const n=t.querySelector(".show-col-detail");n?(n.click(),setTimeout((()=>{const t=document.querySelector(".col-detail-modal");if(!t)return void e({success:!1,message:"La modal de d\xe9tails du col ne s'affiche pas",details:"V\xe9rifiez la fonction showColDetails."});const n=!!t.querySelector(".col-weather"),s=t.querySelector(".close-modal");s&&s.click(),e(n?{success:!0,message:"L'int\xe9gration m\xe9t\xe9o-carte fonctionne correctement",details:"Les donn\xe9es m\xe9t\xe9o s'affichent bien dans les d\xe9tails du col."}:{success:!1,message:"Les donn\xe9es m\xe9t\xe9o ne s'affichent pas dans les d\xe9tails du col",details:"V\xe9rifiez la fonction createColModal et l'appel \xe0 fetchCurrentWeather."})}),2e3)):e({success:!1,message:"Le bouton de d\xe9tails n'est pas pr\xe9sent dans le popup",details:"V\xe9rifiez la structure du popup dans la fonction addCyclingMarkers."})}),1e3)}catch(t){e({success:!1,message:"Exception lors du test d'int\xe9gration m\xe9t\xe9o-carte",details:t.toString()})}else e({success:!1,message:"Le module m\xe9t\xe9o n'est pas correctement initialis\xe9",details:"V\xe9rifiez que le module weather.js est correctement charg\xe9 et initialis\xe9."});else e({success:!1,message:"La carte n'est pas charg\xe9e, impossible de tester l'int\xe9gration m\xe9t\xe9o-carte",details:"Ex\xe9cutez d'abord le test de chargement de la carte."})}))}function v(){w("Chargement de la carte",m).then((()=>w("Marqueurs des cols",p))).then((()=>w("Calcul d'itin\xe9raire",f))).then((()=>w("Profil d'\xe9l\xe9vation",g))).then((()=>w("Fonction d'isochrone",h))).then((()=>{}))}function y(){w("Int\xe9gration M\xe9t\xe9o-Carte",x).then((()=>{}))}function w(e,t){return new Promise((e=>{try{const n=t();n&&"function"===typeof n.then?n.then((t=>{t.success,e(t)})).catch((t=>{e({success:!1,message:"Erreur non g\xe9r\xe9e",details:t.toString()})})):e({success:!0,message:"Test compl\xe9t\xe9 avec succ\xe8s"})}catch(n){e({success:!1,message:"Exception",details:n.toString()})}}))}return{init:function(){!function(){const e=document.createElement("div");e.id="functional-tests-ui",e.className="functional-tests-ui",e.style.display="none";const t=document.createElement("style");t.textContent="\n      .functional-tests-ui {\n        position: fixed;\n        top: 0;\n        right: 0;\n        width: 400px;\n        max-height: 80vh;\n        background: #fff;\n        border-left: 1px solid #ddd;\n        border-bottom: 1px solid #ddd;\n        box-shadow: -2px 2px 10px rgba(0,0,0,0.1);\n        z-index: 1000;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      }\n      \n      .test-header {\n        background: #1F497D;\n        color: white;\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      \n      .test-header h3 {\n        margin: 0;\n        font-size: 16px;\n      }\n      \n      .test-controls {\n        display: flex;\n        gap: 8px;\n      }\n      \n      .test-controls button {\n        background: white;\n        color: #1F497D;\n        border: none;\n        padding: 5px 10px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 12px;\n      }\n      \n      .test-progress {\n        padding: 8px 16px;\n        background: #f5f5f5;\n        border-bottom: 1px solid #ddd;\n      }\n      \n      .progress-bar {\n        height: 6px;\n        background: #eee;\n        border-radius: 3px;\n        overflow: hidden;\n      }\n      \n      .progress-fill {\n        height: 100%;\n        background: #1F497D;\n        width: 0%;\n        transition: width 0.3s ease;\n      }\n      \n      .test-results {\n        flex: 1;\n        overflow-y: auto;\n        padding: 16px;\n      }\n      \n      .test-item {\n        margin-bottom: 12px;\n        border-left: 3px solid #ddd;\n        padding: 8px 12px;\n        background: #f9f9f9;\n      }\n      \n      .test-item.success {\n        border-left-color: #28a745;\n      }\n      \n      .test-item.failure {\n        border-left-color: #dc3545;\n      }\n      \n      .test-item.running {\n        border-left-color: #007bff;\n        animation: pulse 1.5s infinite;\n      }\n      \n      .test-item-header {\n        display: flex;\n        justify-content: space-between;\n        margin-bottom: 4px;\n      }\n      \n      .test-name {\n        font-weight: 600;\n      }\n      \n      .test-status {\n        font-size: 12px;\n        text-transform: uppercase;\n      }\n      \n      .test-item.success .test-status {\n        color: #28a745;\n      }\n      \n      .test-item.failure .test-status {\n        color: #dc3545;\n      }\n      \n      .test-item.running .test-status {\n        color: #007bff;\n      }\n      \n      .test-message {\n        font-size: 13px;\n        color: #555;\n      }\n      \n      .test-details {\n        margin-top: 8px;\n        font-size: 12px;\n        color: #777;\n        padding: 8px;\n        background: #f0f0f0;\n        border-radius: 4px;\n        white-space: pre-wrap;\n      }\n      \n      .test-summary {\n        padding: 12px 16px;\n        border-top: 1px solid #ddd;\n        display: flex;\n        justify-content: space-between;\n      }\n      \n      @keyframes pulse {\n        0% { opacity: 1; }\n        50% { opacity: 0.7; }\n        100% { opacity: 1; }\n      }\n      \n      .visual-indicator {\n        position: fixed;\n        background: rgba(0,0,0,0.7);\n        color: white;\n        padding: 10px 15px;\n        border-radius: 4px;\n        font-size: 14px;\n        z-index: 9999;\n        pointer-events: none;\n      }\n      \n      .test-target-highlight {\n        position: absolute;\n        border: 2px solid #007bff;\n        background: rgba(0, 123, 255, 0.1);\n        z-index: 999;\n        pointer-events: none;\n        border-radius: 3px;\n        transition: all 0.3s ease;\n      }\n    ",document.head.appendChild(t),e.innerHTML='\n      <div class="test-header">\n        <h3>Tests Fonctionnels</h3>\n        <div class="test-controls">\n          <button id="run-all-tests">Lancer tous les tests</button>\n          <button id="run-failed-tests">Relancer les \xe9checs</button>\n          <button id="toggle-test-ui">Masquer</button>\n        </div>\n      </div>\n      \n      <div class="test-progress">\n        <div class="progress-bar">\n          <div class="progress-fill" id="test-progress-fill"></div>\n        </div>\n      </div>\n      \n      <div class="test-results" id="test-results-container"></div>\n      \n      <div class="test-summary">\n        <div id="test-summary-text">0 tests ex\xe9cut\xe9s</div>\n        <div id="test-time">Dur\xe9e: 0s</div>\n      </div>\n    ',document.body.appendChild(e),document.getElementById("run-all-tests").addEventListener("click",c),document.getElementById("run-failed-tests").addEventListener("click",l),document.getElementById("toggle-test-ui").addEventListener("click",(()=>{e.style.display="none"===e.style.display?"flex":"none",document.getElementById("toggle-test-ui").textContent="none"===e.style.display?"Afficher":"Masquer"}));const n=document.createElement("button");n.id="show-tests-button",n.textContent="Tests",n.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      padding: 8px 16px;\n      background: #1F497D;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      z-index: 999;\n      font-size: 14px;\n      box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n    ",n.addEventListener("click",(()=>{e.style.display="flex",document.getElementById("toggle-test-ui").textContent="Masquer"})),document.body.appendChild(n)}(),n&&setTimeout((()=>{c()}),2e3),window.testMap=v,window.testWeather=testWeatherModule,window.testStrava=testStravaModule,window.testAI=testAIModule,window.testIntegration=y,window.runAllTests=c},runAllTests:c,runFailedTests:l,testMapModule:v,testWeatherModule:testWeatherModule,testStravaModule:testStravaModule,testAIModule:testAIModule,testModuleIntegration:y}}();document.addEventListener("DOMContentLoaded",(function(){setTimeout((()=>{FunctionalTests.init()}),1e3)}));